{% extends 'layouts/base.html' %}

{% block content %}
<form method="POST" action="{{url_for("main.corpus_new")}}">
    <h1>Create a new corpus</h1>
    <div class="form-group">
        <label for="corpusName">Corpus Name</label>
        <input name="name" type="text" class="form-control" id="corpusName" aria-describedby="corpusNameHelp" placeholder="Enter name of the corpus" value="{% if name %}{{name}}{%endif%}" />
        <small id="corpusNameHelp" class="form-text text-muted">This should be a clear name</small>
    </div>
    <div class="form-group">
        <label for="context_left">Left Context</label>
        <input name="context_left" type="number" class="form-control" id="context_left" aria-describedby="context_leftHelp" value="{% if name %}{{context_left}}{%else%}3{%endif%}" />
        <small id="context_leftHelp" class="form-text text-muted">Number of words to display on the left of the word to annotate</small>
    </div>
    <div class="form-group">
        <label for="context_right">Right Context</label>
        <input name="context_right" type="number" class="form-control" id="context_right" aria-describedby="context_rightHelp" value="{% if name %}{{context_right}}{%else%}3{%endif%}" />
        <small id="context_rightHelp" class="form-text text-muted">Number of words to display on the right of the word to annotate</small>
    </div>
    <div class="form-group">
        <label for="tokens">Tokens (as TSV content)</label>
        <small id="tsvHelp" class="form-text text-muted">The TSV should at least have the headers : lemma, POS, morph, form</small>
        <textarea aria-describedby="tsvHelp" class="form-control" id="tokens" name="tsv">{% if tsv %}{{tsv}}{%endif%}</textarea>
    </div>
    <div class="form-group row">
        <div class="col-md-3">
            <label for="language-model" id="language-model-label" class="form-text text-muted">
                Lemmatize
            </label>
            <small class="form-text text-muted">If your text is not lemmatized, select the language and click on lemmatize.</small>
        </div>
        <div class="col-md-9">
            <div class="input-group">
              <select class="form-control" id="language-model">
                <option value="http://localhost:5001">Ancien Français</option>
              </select>
              <div class="input-group-append">
                <button id="submit-model" class="btn btn-outline-secondary" type="button">Lemmatize</button>
              </div>
            </div>
        </div>
    </div>
    <div class="form-group row">
        <div  class="col-md-3"><label for="config" class="form-text text-muted">Load a configuration</label>
            <small id="config_loader_help" class="form-text text-muted">If your language is part of the following option, we recommend using the default configuration</small>
       </div>

        <div class="col-md-9">
            <div class="input-group">
              <select class="form-control" id="config">
                <option value="old_french">Ancien Français</option>
                <option value="lasla_la">Latin (LASLA)</option>
              </select>
              <div class="input-group-append">
                <button id="get-config" class="btn btn-outline-secondary" type="button">Load</button>
              </div>
            </div>
            <div>
                <ul>
                    <li style="display: none;" id="config_loader_lemma">Lemma loaded</li>
                    <li style="display: none;" id="config_loader_POS">POS loaded</li>
                    <li style="display: none;" id="config_loader_morph">Morphology loaded</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="allowed_lemma">Allowed lemma</label>
        <small id="allowed_lemma_help" class="form-text text-muted">This should be formatted as a list of lemma separated by new line</small>
        <textarea aria-describedby="allowed_lemma_help" class="form-control" id="allowed_lemma" name="allowed_lemma">{% if allowed_lemma %}{{allowed_lemma}}{%endif%}</textarea>
    </div>
    <div class="form-group">
        <label for="allowed_POS">Allowed POS</label>
        <small id="allowed_POS_help" class="form-text text-muted">This should be formatted as a list of POS separated by comma <b>and no space</b></small>
        <textarea aria-describedby="allowed_POS_help" class="form-control" id="allowed_POS" name="allowed_POS">{% if allowed_POS %}{{allowed_POS}}{%endif%}</textarea>
    </div>
    <div class="form-group">
        <label for="allowed_morph">Allowed Morph (as TSV content)</label>
        <small id="allowed_morph_help" class="form-text text-muted">The TSV should at least have the header : label and could have a <code>readable</code> column for human</small>
        <textarea aria-describedby="allowed_morph_help" class="form-control" id="allowed_morph" name="allowed_morph">{% if allowed_morph %}{{allowed_morph}}{%endif%}</textarea>
    </div>
    <button type="submit" id="submit" class="btn btn-primary">Submit</button>
</form>
<script type="text/javascript">
$(document).ready(function() {
    $("#submit-model").on("click", function(event) {
        event.preventDefault();
        var uri = $("#language-model").val(),
            text_data = $("#tokens");
        $.ajax(
            uri,
            {
                data: {data: text_data.val()},
                method: "POST",

            }
        ).done(function(response) {
            text_data.val(response.replace("token\tlemma\tmorph\tpos", "form\tlemma\tmorph\tPOS"));
        }).fail(function() {
            alert("Something went wrong...");
        });
    });
    $("#get-config").on("click", function(event) {
        event.preventDefault();
        var uri = "{{ url_for("configurations.static", filename='folder') }}".replace("folder", $("#config").val())+"/";

        $.ajax(uri+"lemma.txt").done(function(response) {
                        $("#allowed_lemma").val(response);
                        $("#config_loader_lemma").show();
                    }).fail(function() {
                        alert("Something went wrong...");
                    });

        $.ajax(uri+"POS.txt").done(function(response) {
                        $("#allowed_POS").val(response);
                        $("#config_loader_POS").show();
                    }).fail(function() {
                        alert("Something went wrong...");
                    });
        $.ajax(uri+"morph.txt").done(function(response) {
                        $("#allowed_morph").val(response);
                        $("#config_loader_morph").show();
                    }).fail(function() {
                        alert("Something went wrong...");
                    });
    });
});
</script>
{% endblock %}
